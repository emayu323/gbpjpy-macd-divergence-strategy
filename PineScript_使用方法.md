# GBPJPY System Ver7 - PineScript 使用方法

## 📋 概要

System Ver7（MACD Divergence Strategy）をTradingView用のPineScript v5で実装したインジケーターです。

## 🎯 主な機能

### 1. エントリーシグナル表示
- **買いシグナル**: 緑色の上向き三角形 ▲
- **売りシグナル**: 赤色の下向き三角形 ▼

### 2. ストップロス（SL）・テイクプロフィット（TP）表示
- **SLライン**: 赤色の点線
- **TPライン**: 緑色の点線
- **エントリー価格**: 青色の点線

### 3. 背景色によるエントリー可能状態の表示
- **薄緑色**: 買いセットアップ完了（4時間足上昇トレンド + ダイバージェンス検出）
- **薄赤色**: 売りセットアップ完了（4時間足下降トレンド + ダイバージェンス検出）
- **無色**: エントリー待機中

### 4. 情報パネル
チャート右上に以下の情報を表示：
- 4時間足トレンド（上昇/下降/なし）
- ダイバージェンス状態（買い/売り/なし）
- RCI短期(9)の値
- RCI中期(14)の値
- セットアップ状態（買い可能/売り可能/待機）
- ポジション状態（保有中/なし）

## 🛠️ TradingViewへの導入手順

### ステップ1: PineScriptエディタを開く

1. TradingViewにログイン
2. チャートを開く
3. 画面下部の「Pineエディタ」タブをクリック

### ステップ2: コードを貼り付け

1. `GBPJPY_System_Ver7.pine` ファイルの内容を全てコピー
2. Pineエディタに貼り付け
3. 「保存」ボタンをクリック
4. 「チャートに追加」ボタンをクリック

### ステップ3: 5分足チャートに設定

1. チャート上部の時間軸を **「5分」** に設定
2. 通貨ペアを **「GBPJPY」** に設定

## ⚙️ パラメータ設定

インジケーターの設定（歯車アイコン）から以下を調整できます：

### RCI設定
- **RCI短期**: 9（デフォルト）
- **RCI中期**: 14（デフォルト）
- **RCI売られすぎ**: -60（デフォルト）
- **RCI買われすぎ**: +60（デフォルト）
- **RCI中期売られすぎ**: -40（デフォルト）
- **RCI中期買われすぎ**: +40（デフォルト）

### EMA設定（4時間足トレンド）
- **EMA短期**: 20
- **EMA中期**: 30
- **EMA長期**: 40

### MACD設定（1時間足ダイバージェンス）
- **MACD Fast**: 12
- **MACD Slow**: 26
- **MACD Signal**: 9

### ZigZag設定
- **ZigZag 5分足 Depth**: 5（SL計算用）
- **ZigZag 1時間足 Depth**: 12（ダイバージェンス検出用）

### リスク管理
- **リスクリワード**: 1.5（デフォルト）
- **SLバッファ**: 2.0 pips

### 表示設定
- **エントリーシグナル表示**: ON/OFF
- **SL/TP表示**: ON/OFF
- **ダイバージェンス表示**: ON/OFF
- **背景色表示**: ON/OFF

## 📊 使い方

### 1. エントリータイミングの確認

#### 買いエントリー
1. 背景が**薄緑色**になる（買いセットアップ）
2. 情報パネルで以下を確認：
   - 4H トレンド: 上昇
   - ダイバージェンス: 買い
   - セットアップ: 買い可能
3. **緑色の上向き三角形 ▲** が表示されたらエントリー

#### 売りエントリー
1. 背景が**薄赤色**になる（売りセットアップ）
2. 情報パネルで以下を確認：
   - 4H トレンド: 下降
   - ダイバージェンス: 売り
   - セットアップ: 売り可能
3. **赤色の下向き三角形 ▼** が表示されたらエントリー

### 2. ポジション管理

エントリー後、以下のラインが表示されます：
- **青色の点線**: エントリー価格
- **赤色の点線**: ストップロス（損切り）
- **緑色の点線**: テイクプロフィット（利確）

### 3. エグジット

以下のいずれかで自動的にポジションがクローズされます：
- 価格がTPラインに到達（利確）
- 価格がSLラインに到達（損切り）

## 🔔 アラート設定

TradingViewのアラート機能を使用して通知を受け取れます：

1. チャート右側の「アラート」ボタンをクリック
2. 条件を選択：
   - **買いシグナル**: 買いエントリーチャンス
   - **売りシグナル**: 売りエントリーチャンス
   - **買いセットアップ**: 買いの準備完了
   - **売りセットアップ**: 売りの準備完了
3. 通知方法を設定（アプリ通知、メール、Webhookなど）

## ⚠️ 注意事項

### 1. 上位足データの制限
- PineScriptでは完全なダイバージェンス検出が困難なため、簡易版を実装
- より正確な検出には、手動で1時間足チャートを確認することを推奨

### 2. リペイント問題
- ZigZagやダイバージェンス検出は過去のバーが確定するまで変更される可能性あり
- エントリーは必ずバーが確定してから実行すること

### 3. バックテスト結果との差異
- PineScriptの制約により、Pythonバックテストと完全に同じ結果にならない場合あり
- 特にダイバージェンス検出ロジックが簡易版のため

### 4. 推奨環境
- **時間足**: 5分足
- **通貨ペア**: GBPJPY
- **取引時間**: 日本時間 08:00 ~ 24:00

## 📈 バックテスト結果（参考）

Pythonでの検証結果（2015-2025年）：
- 勝率: 57.28%
- 総利益: +2,737.05 pips
- プロフィットファクター: 1.39
- 総トレード数: 412件

## 🆘 トラブルシューティング

### シグナルが表示されない
- 5分足チャートになっているか確認
- GBPJPYチャートになっているか確認
- パラメータが正しく設定されているか確認

### 背景色が表示されない
- 設定で「背景色表示」がONになっているか確認
- 4時間足でトレンドが発生しているか確認

### SL/TPラインが表示されない
- エントリーシグナルが発生しているか確認
- 設定で「SL/TP表示」がONになっているか確認

## 📝 カスタマイズ

### パラメータ調整の例

#### より積極的にエントリーしたい場合
- RCI閾値を緩和：売られすぎ -60 → -50、買われすぎ +60 → +50
- RCI中期閾値を緩和：±40 → ±30

#### より慎重にエントリーしたい場合
- RCI閾値を厳格化：売られすぎ -60 → -70、買われすぎ +60 → +70
- リスクリワードを拡大：1.5 → 2.0

## 📚 参考資料

- ENTRY_LOGIC.md: 戦略の詳細な説明
- backtest_report_v7.txt: Pythonバックテスト結果
- trades_v7.csv: トレード履歴詳細

---

**重要**: このインジケーターは教育目的で作成されています。実際の取引に使用する前に、デモ口座で十分にテストしてください。
