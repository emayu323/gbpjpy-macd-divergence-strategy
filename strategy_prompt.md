# 役割
あなたはPythonによる金融データ分析とバックテストの専門家です。
添付したGBPJPYの価格データ（1時間足および5分足）を使用し、指定されたパフォーマンス条件（勝率50%かつリスクリワード1:2）を満たすトレード戦略を構築・検証してください。

# 目標パフォーマンス（必須）
- **勝率**: 50%以上
- **リスクリワード (RR)**: 1 : 2 (損失1に対して利益2)
- **スタイル**: 1時間足で環境認識し、5分足でエントリー
- **トレード時間**: 日本時間 08:00 〜 24:00 (00:00) の間にエントリーを限定

# 使用するテクニカル指標とパラメータ
全ての計算はPythonで行ってください。
1. **EMA (指数平滑移動平均)**
   - 期間: 20, 30, 40
2. **ZigZag (2種類)**
   - 設定A (短期): Depth 5, Deviation 3, Backstep 2
   - 設定B (長期): Depth 12, Deviation 5, Backstep 3
   - ※計算ロジックについては、添付の `sukepoyo_sub.pine` を参照し、同様の挙動になるようにPythonで実装すること。
3. **RCI (順位相関指数)**
   - 期間: Short(9), Mid(14), Long(18)
4. **MACD (短期設定)**
   - Fast 6, Slow 13, Signal 4
   - ダイバージェンスおよびヒドゥンダイバージェンスの判定ロジックを組み込むこと。

# 検証プロセス（Python実行手順）

## Step 1: データ前処理と指標計算
- 1時間足、5分足それぞれのデータフレームを作成し、上記インジケーターを計算して列に追加する。
- データのタイムゾーンを日本時間(JST)に合わせ、トレード対象時間（08:00～24:00）を識別できるようにする。
- 1時間足のトレンド情報（EMAの並び、ZigZagのダウ理論状況）を5分足データにマージ（タイムスタンプ調整）する。

## Step 2: エントリー条件の探索
以下のベースロジックを基準に、**勝率50%・RR1:2を達成できるフィルター条件**を見つけ出してください。
- **基本戦略**: 1時間足のトレンド方向への順張り（押し目買い・戻り売り）。
- **トリガー候補**:
  - 5分足でのMACDダイバージェンス発生
  - 5分足RCIの反転（例: 2本以上が底値圏から上昇）
  - 5分足ZigZagのブレイク

## Step 3: 損切り(SL)と利確(TP)のシミュレーション
エントリー毎に以下を適用して勝敗を判定する。
- **SL設定**: 直近の5分足ZigZag(Short)の安値（ロングの場合）または高値（ショートの場合）。
- **TP設定**: SLまでのpips幅 × 2.0 (固定)。
- ※スプレッドとして 1.5 pips をコストに加算すること。

## Step 4: 最適化と出力
単純なロジックでは勝率50%かつRR1:2の達成は困難であるため、以下の条件を厳しくして「無駄なトレード」を排除し、目標数値をクリアする条件の組み合わせを特定してください。
- 1時間足のRCIの状況（方向感が揃っている時のみ、など）
- 1時間足MACDのヒドゥンダイバージェンスの有無
- 5分足EMAと価格の乖離率

# 最終成果物（アウトプット）
分析結果に基づき、以下のフォーマットで出力してください。

1. **達成できたパフォーマンス**
   - 総トレード数
   - 勝率
   - プロフィットファクター
   - 最大ドローダウン

2. **特定された「勝てる」トレードルール**
   - **1時間足の条件**: (例: EMA20>30>40 かつ RCI長期が上昇中であること)
   - **5分足のエントリー条件**: (例: MACDダイバージェンス発生後、RCI短期が-80を上抜けた瞬間)
   - **損切り・利確ルール**: (シミュレーションで使用した具体的定義)

3. **改善の考察**
   - 目標未達の場合は、どの条件がボトルネックになったか、またはどの指標が最もダマシ回避に有効だったか。
